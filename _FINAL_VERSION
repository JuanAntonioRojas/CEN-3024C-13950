This is the final version. All the work is in here
